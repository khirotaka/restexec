# Gemini に対する指示書

あなたは、このプロジェクトの協力者の一員です。
Pull Request のレビューを行う際は、以下のルールを厳格に守ってください。

## 基本ルール
- レビューコメントは日本語で記述してください。
- 変更内容だけでなく、その意図や背景も考慮してください。
- ポジティブなフィードバックも歓迎します。

## レビューの観点

### 1. コーディング規約の遵守 (`deno.json` 準拠)

`deno fmt` と `deno lint` の規約に従っているかを確認してください。

- **フォーマット (`fmt`):**
  - インデント: スペース2つ
  - 1行の長さ: 120文字
  - セミコロン: 必須
  - 文字列: シングルクォート (`'`)
- **リンター (`lint`):**
  - Deno の推奨ルール (`"tags": ["recommended"]`) に違反していないか。
  - 未使用の変数やインポートがないか。

### 2. 型安全性 (`strict: true`)

- `any` 型の使用は原則として禁止です。代替可能な具体的な型（`unknown`, `Record<string, unknown>` など）を提案してください。
- すべての関数、変数、パラメータには、可能な限り型を明記してください。
- Deno や外部ライブラリが提供する型を積極的に利用してください。

### 3. テスト

- 新機能の追加やバグ修正には、必ず対応するテスト (`tests/` 以下) が含まれているか確認してください。
- テストが不十分な場合は、どのようなテストケースを追加すべきか具体的に提案してください。
- すべてのテストが `deno test` コマンドで成功することを確認してください。

### 4. アーキテクチャと設計

- `README.md` に記載されているシステムアーキテクチャを尊重してください。
  - Oak フレームワークの利用方法が適切か。
  - `executor.ts` や `processManager.ts` の責務から逸脱していないか。
- 関心の分離が適切に行われているか確認してください。
- Deno のパーミッションモデルを考慮し、スクリプトに与える権限が最小限になっているか確認してください。

### 5. 依存関係の管理

- 新しい外部ライブラリを追加する場合、`deps.ts` ファイルで一元管理されているか確認してください。
- このプロジェクトは `--cached-only` フラグで動作するため、新しい依存関係を追加した場合はコンテナの再ビルドが必要であることを指摘してください。詳細は `specs/Libraries.md` を参照するように促してください。

### 6. ドキュメントとコメント

- API の仕様変更（エンドポイント、リクエスト/レスポンス）があった場合、`specs/API.md` などの関連ドキュメントの更新が必要であることを指摘してください。
- 複雑なロジックや、一読して意図が分かりにくいコードには、その理由や目的を説明するコメントを追加するように提案してください。

### 7. セキュリティ

- Deno のパーミッション (`--allow-*`) が必要最小限になっているか、常に注意してください。
- 外部からの入力（リクエストボディ、パラメータなど）は、`middleware/validation.ts` などで適切にバリデーションされているか確認してください。
- シェルコマンドの実行など、インジェクションの脆弱性につながる可能性のある処理がないか、特に注意深くレビューしてください。